import{u as r,j as s}from"./index-phq109e0.js";const a={title:"AMM 层 | PoolManager",description:"undefined"};function e(l){const i={a:"a",code:"code",div:"div",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...r(),...l.components};return s.jsxs(s.Fragment,{children:[s.jsx(i.header,{children:s.jsxs(i.h1,{id:"amm-层--poolmanager",children:["AMM 层 | PoolManager",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#amm-层--poolmanager",children:s.jsx(i.div,{"data-autolink-icon":!0})})]})}),`
`,s.jsx(i.p,{children:"Pool Managers 是单例合约，封装了不同类型 AMMs 的逻辑。在初始部署中，将有 2 种 AMM 类型，访问它们各自的页面了解更多信息。"}),`
`,s.jsxs(i.ol,{children:[`
`,s.jsx(i.li,{children:s.jsx(i.a,{href:"/contracts/v4/overview/amm-layer/concentrated-liquidity",children:"CLPoolManager"})}),`
`,s.jsx(i.li,{children:s.jsx(i.a,{href:"/contracts/v4/overview/amm-layer/liquidity-book",children:"BinPoolManager"})}),`
`]}),`
`,s.jsxs(i.h3,{id:"单例",children:["单例",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#单例",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:["在 PancakeSwap v3 中，每个池都是一个独立的合约。在 PancakeSwap v4 中，所有池将被封装在一个单一的 PoolManager 合约中。例如，所有集中流动性池在 ",s.jsx(i.a,{href:"https://github.com/pancakeswap/pancake-v4-core/blob/main/src/pool-cl/CLPoolManager.sol",children:"CLPoolManager"})," 中，以及所有流动性书池在 ",s.jsx(i.a,{href:"https://github.com/pancakeswap/pancake-v4-core/blob/main/src/pool-bin/BinPoolManager.sol",children:"BinPoolManager"})," 中。"]}),`
`,s.jsxs(i.h3,{id:"poolkey--poolid",children:["PoolKey | PoolId",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#poolkey--poolid",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:[s.jsx(i.a,{href:"https://github.com/pancakeswap/pancake-v4-core/blob/main/src/types/PoolKey.sol",children:"PoolKey"})," 是描述每个池的结构体。"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"/// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 返回用于标识池的关键数据"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"struct"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:" PoolKey"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"    /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 池中的低阶货币，按数值排序"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    Currency currency0;"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"    /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 池中的高阶货币，按数值排序"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    Currency currency1;"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"    /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 池的钩子，不会有通用接口，因为钩子接口因池类型不同"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    IHooks hooks;"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"    /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 池的池管理器"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    IPoolManager poolManager;"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"    /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 池的交换费，上限为1_000_000。上位 4 位确定钩子是否设置费用。"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"    uint24"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" fee;"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"    /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@notice"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 钩子的回调和池的特定参数，例如 CL 的 tickSpacing，bin 的 binStep"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"    bytes32"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" parameters;"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"}"})})]})}),`
`,s.jsxs(i.p,{children:[s.jsx(i.a,{href:"https://github.com/pancakeswap/pancake-v4-core/blob/main/src/types/PoolId.sol",children:"PoolId"})," 是 ",s.jsx(i.code,{children:"keccak256(abi.encode(poolKey))"})," 的 bytes32 。您会注意到某些来自 PoolManager 的输入需要 PoolId。通过以下方法从 ",s.jsx(i.code,{children:"PoolKey"})," 派生 ",s.jsx(i.code,{children:"PoolId"}),"："]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" {"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"PoolIdLibrary"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"} "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),s.jsx(i.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "@pancakeswap/v4-core/src/types/PoolId.sol"'}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,s.jsx(i.span,{className:"line","data-empty-line":!0,children:" "}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 对 PoolKey 类型使用 PoolIdLibrary"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"using"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:" PoolIdLibrary"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" for"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:" PoolKey"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,s.jsx(i.span,{className:"line","data-empty-line":!0,children:" "}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"PoolKey "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"memory"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" key "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"="}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" PoolKey"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  currency0"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:":"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" currency0,"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  currency1"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:":"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" currency1,"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  hooks"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:":"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" IHooks"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"address"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:")),"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  poolManager"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:":"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" poolManager,"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  fee"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:":"}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" uint24"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"3000"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  parameters"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:":"}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" bytes32"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint256"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(counterHook."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"getHooksRegistrationBitmap"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()))."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"setTickSpacing"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:")"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,s.jsx(i.span,{className:"line","data-empty-line":!0,children:" "}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 通过 PoolIdLibrary 从 PoolKey 获取 PoolId"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"Poolid id "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"="}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" key."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"toId"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})]})}),`
`,s.jsxs(i.h3,{id:"初始化池",children:["初始化池",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#初始化池",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:["在池上进行交换或流动性操作之前，首先需要初始化池。要初始化，请调用 ",s.jsx(i.code,{children:"CLPoolManager"})," 或 ",s.jsx(i.code,{children:"BinPoolManager"})," 的初始化方法。"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// CLPoolManager"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"function"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" initialize"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"PoolKey"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" memory"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" key"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint160"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" sqrtPriceX96"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"bytes"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" calldata"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" hookData"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]}),`
`,s.jsx(i.span,{className:"line","data-empty-line":!0,children:" "}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// BinPoolManager"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"function"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" initialize"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"PoolKey"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" memory"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" key"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint24"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" activeId"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"bytes"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" calldata"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" hookData"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})]})})]})}function o(l={}){const{wrapper:i}={...r(),...l.components};return i?s.jsx(i,{...l,children:s.jsx(e,{...l})}):e(l)}export{o as default,a as frontmatter};
