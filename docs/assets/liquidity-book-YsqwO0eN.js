import{u as l,j as s,C as r}from"./index-phq109e0.js";import"./HomePage.css.js.vanilla-w40geAFS.js";const c={title:"Liquidity Book",description:"undefined"};function e(n){const i={a:"a",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",span:"span",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...l(),...n.components};return s.jsxs(s.Fragment,{children:[s.jsx(i.header,{children:s.jsxs(i.h1,{id:"liquidity-book",children:["Liquidity Book",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#liquidity-book",children:s.jsx(i.div,{"data-autolink-icon":!0})})]})}),`
`,s.jsxs(i.h2,{id:"概览",children:["概览",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#概览",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsx(i.p,{children:"在 Liquidity Book AMM 类型中，流动性提供者（LPs）可以灵活地在一次调用中以任意形态添加流动性。而在集中流动性类型中，流动性是在所选价格区间内以均匀方式添加的。"}),`
`,s.jsx(i.p,{children:"要添加流动性，LP 需要指定一个 byte32 类型的 liquidityConfigs 数组。数组中的每一项都表示将多少 amountIn 的百分比添加到哪个 bin 中。欲了解更多详细信息，请参阅关于 Liquidity Book 的指南部分。"}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"struct"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:" MintParams"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"  /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@dev"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 详见 LiquidityConfigurations.sol"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"  ///   [0 - 24[: id"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"  ///   [24 - 88[: distributionY - 1e18 代表 100% 的代币进入该 bin"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"  ///   [88 - 152[: distributionX - 1e18 代表 100% 的代币进入该 bin"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"  ///   [152 - 256[: 空的"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"  bytes32"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"[] liquidityConfigs;"})]}),`
`,s.jsx(i.span,{className:"line","data-empty-line":!0,children:" "}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"  /// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@dev"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 预期的 amountIn"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"  bytes32"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" amountIn;"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"}"})}),`
`,s.jsx(i.span,{className:"line","data-empty-line":!0,children:" "}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"/// "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"@dev"}),s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" 详见 BinPoolManager.sol "})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"function"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" mint"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"PoolKey"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" memory"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" key"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"IBinPoolManager"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"MintParams"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" calldata"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" params"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"bytes"}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" calldata"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" hookData"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})]})}),`
`,s.jsxs(i.h2,{id:"概念",children:["概念",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#概念",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.h3,{id:"bin",children:["Bin",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#bin",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsx(i.p,{children:s.jsx(i.img,{src:"/pancake-developer/v4/amm-layer-poolmanager-bin-1.png",alt:"Liquidity book"})}),`
`,s.jsx(i.p,{children:"可以把 bin 想象成流动性所在的桶，每个池都有有限数量的 bin。每个 bin 都有一个相关的价格和 id。"}),`
`,s.jsx(r,{type:"info",children:s.jsx(i.p,{children:"如果交易发生在某个 bin 内部，则不会产生滑点。然而，如果交易耗尽了 bin 内的所有流动性并跨越到下一个 bin，则会产生滑点。"})}),`
`,s.jsxs(i.h3,{id:"bin-步长",children:["Bin 步长",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#bin-步长",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:["Bin 步长定义了两个相邻 bin 之间的最小价格变动。这是 ",s.jsx(i.code,{children:"PoolKey"})," 中的一个参数。请记住，这里有权衡。虽然较小的 bin 步长允许更精确地定位流动性，但可能会带来较高的 gas 费用。较大的 bin 步长可能会降低 gas 费用，但在执行交易时的滑点可能较高。"]}),`
`,s.jsxs(i.table,{children:[s.jsx(i.thead,{children:s.jsxs(i.tr,{children:[s.jsx(i.th,{children:"Bin 步长"}),s.jsx(i.th,{children:"bin 之间的价格变动"})]})}),s.jsxs(i.tbody,{children:[s.jsxs(i.tr,{children:[s.jsx(i.td,{children:"1"}),s.jsx(i.td,{children:"0.01%"})]}),s.jsxs(i.tr,{children:[s.jsx(i.td,{children:"10"}),s.jsx(i.td,{children:"0.1%"})]}),s.jsxs(i.tr,{children:[s.jsx(i.td,{children:"20"}),s.jsx(i.td,{children:"0.2%"})]}),s.jsxs(i.tr,{children:[s.jsx(i.td,{children:"100"}),s.jsx(i.td,{children:"1%"})]})]})]}),`
`,s.jsxs(i.p,{children:["在初始部署时，池中的最大 ",s.jsx(i.code,{children:"BIN_STEP"})," 可以为 100。未来可以通过治理流程提高这个限值。"]}),`
`,s.jsxs(i.h3,{id:"bin-活动-id",children:["Bin 活动 id",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#bin-活动-id",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:["可以将 ",s.jsx(i.code,{children:"activeId"})," 视为当前的 bin id。要检索 bin 的 activeId"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// ref: BinPoolManager.sol"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"binPoolManager."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"getSlot0"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(PoolId) "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"external"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" "})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"  returns"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" ("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint24"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" activeId"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint16"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" protocolFee"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint24"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" swapFee"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})]})}),`
`,s.jsxs(i.h3,{id:"bin-定价",children:["Bin 定价",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#bin-定价",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:["给定当前的 ",s.jsx(i.code,{children:"activeId"})," 和 ",s.jsx(i.code,{children:"binStep"}),"，我们可以计算出池的当前价格。"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsx(i.code,{children:s.jsx(i.span,{className:"line",children:s.jsx(i.span,{children:"price: (1 + binStep / 10_000) ** (activeId - 8388608)"})})})}),`
`,s.jsx(i.p,{children:"示例：USDT/USDC 池，bin step = 1 且 activeId = 8388608"}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{children:"price: (1 + 1 / 10_000) ** (8388608 - 8388608) = 1"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{children:"// 这意味着 1 USDT = 1 USDC"})})]})}),`
`,s.jsxs(i.h3,{id:"可替换流动性",children:["可替换流动性",s.jsx(i.a,{"aria-hidden":"true",tabIndex:"-1",href:"#可替换流动性",children:s.jsx(i.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(i.p,{children:["Liquidity book 的一个优势是可替换流动性。可替换流动性在下游的 DeFi 应用中提供了灵活性。当 LP 通过 ",s.jsx(i.code,{children:"BinFungiblePositionManager.sol"})," 添加流动性时，他们会获得 ERC1155 代币。"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"/// 参考 BinFungibleToken.sol (类似于 ERC1155)"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"function"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" _mint"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"address"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" to"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint256"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" id"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(i.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"uint256"}),s.jsx(i.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" amount"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:") "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"internal"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  totalSupply[id] "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"+="}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" amount;"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"  unchecked"}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    balanceOf[to][id] "}),s.jsx(i.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"+="}),s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" amount;"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"}"})})]})}),`
`,s.jsxs(i.p,{children:["请参阅 ",s.jsx(i.a,{href:"https://github.com/pancakeswap/pancake-v4-periphery/blob/main/src/pool-bin/BinFungiblePositionManager.sol#L189",children:"BinFungiblePositionManager"}),"，了解如何向流动性提供者铸造代币。"]})]})}function h(n={}){const{wrapper:i}={...l(),...n.components};return i?s.jsx(i,{...n,children:s.jsx(e,{...n})}):e(n)}export{h as default,c as frontmatter};
